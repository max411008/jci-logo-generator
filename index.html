<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JCI Logo Generator (V4.8 Final)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* 全局字型與重置 */
        @font-face { font-family: 'Plus Jakarta Sans'; src: url('PlusJakartaSans-Bold.ttf') format('truetype'); font-weight: bold; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f8f9fa; 
            margin: 0; 
            padding: 0;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
            color: #333;
        }

        /* --- 1. App 頂部導航列 --- */
        .navbar {
            width: 100%;
            background-color: #0097D7;
            color: white;
            padding: 16px 0;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            margin-bottom: 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* --- 2. 操作面板 --- */
        .controls { 
            background: white; 
            padding: 24px; 
            border-radius: 16px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.06); 
            display: flex; 
            gap: 16px; 
            align-items: flex-end; 
            margin-bottom: 24px; 
            flex-wrap: wrap; 
            justify-content: center; 
            max-width: 800px;
            width: 90%;
        }
        
        .input-group { display: flex; flex-direction: column; gap: 6px; }
        label { font-size: 13px; font-weight: 700; color: #555; margin-left: 2px; }
        input, select { 
            padding: 10px 14px; 
            font-size: 15px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            min-width: 160px; 
            background-color: #fdfdfd;
            transition: border-color 0.2s;
        }
        input:focus, select:focus { border-color: #0097D7; outline: none; }
        
        /* 雙語警告訊息樣式 */
        .warning-msg {
            display: none; 
            color: #dc3545; 
            font-size: 13px;
            line-height: 1.5;
            margin-top: 6px;
            background-color: #ffe6e6;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #ffcccc;
            width: 100%;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .warning-divider {
            border: 0;
            border-top: 1px dashed #ffb3b3;
            margin: 6px 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn-download { 
            padding: 10px 24px; 
            font-size: 15px; 
            font-weight: bold; 
            color: white; 
            background-color: #0097D7; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            height: 42px; 
            transition: background-color 0.2s;
            box-shadow: 0 4px 10px rgba(0, 151, 215, 0.2);
        }
        .btn-download:hover { background-color: #007bb5; }
        .btn-download:disabled { background-color: #ccc; box-shadow: none; cursor: not-allowed; }

        /* --- 3. 預覽區 (編輯模式) --- */
        .preview-container { 
            position: relative; 
            width: 550px;       
            padding: 20px; 
            max-width: 95%; 
            border: 1px solid #eee; 
            background-color: #fff; 
            box-sizing: border-box; 
            margin: 0 auto;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            pointer-events: none; 
            user-select: none;
            -webkit-user-select: none;
        }

        .preview-container.generated-mode {
            pointer-events: auto !important;
            user-select: auto !important;
            -webkit-user-select: auto !important;
            border: 2px dashed #0097D7;
        }
        
        .preview-container.generated-mode img {
             pointer-events: auto !important;
             -webkit-touch-callout: default !important;
        }

        .logo-wrapper { position: relative; width: 100%; container-type: inline-size; }
        .logo-wrapper img { width: 100%; display: block; }
        
        #finalResultImg { width: 100%; display: none; border-radius: 4px; }

        /* --- 品牌規範核心定位 --- */
        .chapter-name-wrapper {
            position: absolute;
            top: 66.2%;
            left: 11.8%;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: bold;
            max-width: 55%; 
            text-align: left;
            overflow: visible; 
        }

        .text-line { 
            font-size: 8.0cqi;
            line-height: 0.8;
            white-space: nowrap; 
            letter-spacing: 0.005em; 
        }

        #chapterTextLine2 { margin-top: 2.6cqi; }

        .hidden { display: none !important; }
        .text-jci-blue { color: #0097D7 !important; }
        .text-white { color: #ffffff !important; } 
        .text-black { color: #1c1f2a !important; }

        /* --- 4. 底部版權聲明 --- */
        .footer { 
            margin-top: auto; 
            padding: 40px 20px; 
            width: 100%; 
            text-align: center; 
            color: #666; 
            font-size: 14px;
            line-height: 1.8; 
            background-color: #fff;
            border-top: 1px solid #eee;
        }
        
        .footer-block { margin-bottom: 15px; } 

        /* 連結樣式：青商會官網 */
        .footer-link {
            color: #333; 
            text-decoration: none;
            font-weight: bold;
            border-bottom: 1px dotted #999; 
            transition: color 0.2s, border-bottom 0.2s;
        }
        .footer-link:hover { color: #0097D7; border-bottom: 1px solid #0097D7; }

        /* 連結樣式：個人FB (藍色) */
        .footer-link-blue {
            color: #0097D7; /* JCI Blue */
            text-decoration: none;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        .footer-link-blue:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        .copyright-warning { 
            margin-top: 20px; 
            padding-top: 15px;
            border-top: 1px dashed #eee; 
            font-size: 12px; 
            color: #aaa; 
            font-style: italic; 
            line-height: 1.5;
        }

        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
                align-items: stretch; 
                gap: 12px;
                padding: 20px;
            }
            .input-group { width: 100%; }
            input, select { width: 100%; min-width: auto; }
            .btn-download { width: 100%; margin-top: 8px; height: 48px; font-size: 16px; }
            .navbar { font-size: 18px; padding: 14px 0; margin-bottom: 20px; }
        }
    </style>
</head>
<body>

    <nav class="navbar">JCI Logo Generator</nav>

    <div class="controls">
        <div class="input-group">
            <label>分會名稱 (Line 1)</label>
            <input type="text" id="chapterInput1" value="Dayuan" oninput="updateLogo()">
            
            <div id="lengthWarning" class="warning-msg">
                <strong>⚠️ 文字過長 (Point 4)</strong><br>
                已超出盾牌右緣範圍，請將多餘文字移至第二行。
                <hr class="warning-divider">
                <strong>⚠️ Text too long (Point 4)</strong><br>
                Exceeds the shield's right edge. Please move extra text to Line 2.
            </div>
        </div>
        <div class="input-group">
            <label>分會名稱 (Line 2, 選填)</label>
            <input type="text" id="chapterInput2" value="" oninput="updateLogo()">
        </div>
        <div class="input-group">
            <label>Logo 樣式</label>
            <select id="logoSelect" onchange="changeLogoStyle()">
                <option value="New JCI Logo_Primary.png|#ffffff|jci-blue">Primary (白底藍字)</option>
                <option value="New JCI Logo_Secondary - White on JCI Blue.png|#0097D7|white">Blue Background (藍底白字)</option>
                <option value="New JCI Logo_Secondary - White.png|#1c1f2a|white">Dark Background (深底白字)</option>
                <option value="New JCI Logo_Secondary - Inverted Color on JCI Black.png|#000000|white">Inverted (黑底白字)</option>
                <option value="New JCI Logo_Secondary - JCI Black.png|#ffffff|black">Black Text (白底黑字)</option>
            </select>
        </div>
        <div class="input-group">
            <label>輸出品質</label>
            <select id="sizeSelect">
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="3" selected>3x</option>
                <option value="5">5x</option>
            </select>
        </div>
        <div class="input-group" style="display:none;">
            <select id="colorSelect" onchange="updateLogo()">
                <option value="text-jci-blue">JCI Blue</option>
                <option value="text-white">White</option>
                <option value="text-black">Black</option>
            </select>
        </div>
        <button class="btn-download" onclick="generateImage()">生成圖片 / Generate Image</button>
    </div>

    <div class="preview-container" id="previewBox">
        <div class="logo-wrapper" id="captureTarget">
            <img id="logoImg" src="New JCI Logo_Primary.png">
            <div id="chapterTextWrapper" class="chapter-name-wrapper">
                <div id="chapterTextLine1" class="text-line text-jci-blue">Dayuan</div>
                <div id="chapterTextLine2" class="text-line text-jci-blue hidden"></div>
            </div>
        </div>
        <img id="finalResultImg" alt="Generated Logo">
    </div>

    <div class="footer">
        <div class="footer-block">
            Designed & Developed by 
            <a href="https://www.facebook.com/zhenhui.lin/" target="_blank" class="footer-link-blue">Chenghui Lin</a><br>
            (2023 President, JCI Dayuan)
        </div>
        <div class="footer-block">
            <a href="https://www.jcidayuan.site/" target="_blank" class="footer-link">桃園市大園國際青年商會</a> 
            <a href="https://www.facebook.com/zhenhui.lin/" target="_blank" class="footer-link-blue">2023年會長 林振暉</a> 製作<br>
            Copyright &copy; 2026 Chenghui Lin. All rights reserved.
        </div>
        <div class="copyright-warning">
            本程式由 2023 大園青商 林振暉 會長為服務 JCI 夥伴免費開發。<br>
            歡迎廣泛使用，惟請尊重原創開發者成果，請勿私自盜用、修改或宣稱為個人作品。
        </div>
    </div>

    <script>
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        window.onload = function() { changeLogoStyle(); };

        function changeLogoStyle() {
            var parts = document.getElementById('logoSelect').value.split('|');
            document.getElementById('logoImg').src = parts[0];
            document.getElementById('previewBox').style.backgroundColor = parts[1];
            var defaultColor = parts[2];
            var colorSelect = document.getElementById('colorSelect');
            if(defaultColor === 'jci-blue') colorSelect.value = 'text-jci-blue';
            else if (defaultColor === 'white') colorSelect.value = 'text-white';
            else colorSelect.value = 'text-black';
            updateLogo();
        }

        function updateLogo() {
            var input1 = document.getElementById('chapterInput1').value;
            var input2 = document.getElementById('chapterInput2').value;
            var colorClass = document.getElementById('colorSelect').value;
            var line1Div = document.getElementById('chapterTextLine1');
            var line2Div = document.getElementById('chapterTextLine2');
            
            line1Div.textContent = input1;
            line1Div.className = 'text-line ' + colorClass;
            if (input2.trim() !== "") {
                line2Div.textContent = input2;
                line2Div.className = 'text-line ' + colorClass;
                line2Div.classList.remove('hidden');
            } else {
                line2Div.classList.add('hidden');
            }

            var warningDiv = document.getElementById('lengthWarning');
            if (line1Div.scrollWidth > line1Div.clientWidth) {
                warningDiv.style.display = 'block'; 
            } else {
                warningDiv.style.display = 'none';  
            }

            resetPreviewState();
        }

        function resetPreviewState() {
            document.getElementById('captureTarget').style.display = 'block'; 
            document.getElementById('finalResultImg').style.display = 'none'; 
            document.getElementById('previewBox').classList.remove('generated-mode'); 
        }

        async function generateImage() {
            var element = document.getElementById('captureTarget');
            var btn = document.querySelector('.btn-download');
            var qualityScale = parseFloat(document.getElementById('sizeSelect').value);

            btn.innerText = "處理中...";
            btn.disabled = true;

            var finalScale = qualityScale * 2;
            if (isIOS() && finalScale > 7) {
                finalScale = 7; 
            }

            resetPreviewState();
            await new Promise(resolve => setTimeout(resolve, 50));

            try {
                const canvas = await html2canvas(element, { 
                    backgroundColor: null, 
                    scale: finalScale, 
                    useCORS: true 
                });

                const imgData = canvas.toDataURL("image/png");

                document.getElementById('captureTarget').style.display = 'none';
                
                var finalImg = document.getElementById('finalResultImg');
                finalImg.src = imgData;
                finalImg.style.display = 'block';
                
                document.getElementById('previewBox').classList.add('generated-mode');

                let msg = "";
                if (isMobile()) {
                    msg = "✅ 圖片已生成！\n\n請直接「長按」下方的圖片，並選擇「儲存到相簿」。\n(若需修改文字，輸入新內容即可恢復編輯模式)";
                } else {
                    msg = "✅ 圖片已生成！\n\n請在下方的圖片上「按右鍵」，並選擇「另存圖片」來下載。\n(若需修改文字，輸入新內容即可恢復編輯模式)";
                }
                
                alert(msg);

            } catch (err) {
                console.error(err);
                alert("生成失敗，請重新整理頁面再試。");
            } finally {
                btn.innerText = "生成圖片 / Generate Image";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>